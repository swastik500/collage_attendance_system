<!-- templates/partials/_announcements.html -->

{% if announcements %}
<div class="management-section mt-5">
    <h5 class="mb-3"><i class="fas fa-bullhorn me-2"></i>Recent Announcements</h5>
    <div class="list-group">
        {% for announcement in announcements %}
        <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between">
                <h6 class="mb-1">{{ announcement.title }}</h6>
                <small class="text-secondary">{{ announcement.created_at|timesince }} ago</small>
            </div>
            <p class="mb-1">{{ announcement.content|linebreaksbr }}</p>

            <!-- === ADD THIS NEW SECTION === -->
            <div class="d-flex w-100 justify-content-between align-items-center mt-2">
                <small class="text-secondary">Posted by: {{ announcement.posted_by.get_full_name|default:'Admin' }}</small>

                <!-- Conditionally show the delete button only for Admins -->
                {% if request.user.role == 'ADMIN' %}
                <form action="{% url 'admin_announcement_delete' announcement.pk %}" method="post" onsubmit="return confirm('Are you sure you want to delete this announcement?');">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-sm btn-outline-danger">
                        <i class="fas fa-trash-alt"></i> Delete
                    </button>
                </form>
                {% endif %}
            </div>
            <!-- === END OF NEW SECTION === -->

        </div>
        {% endfor %}
    </div>
</div>
{% endif %}